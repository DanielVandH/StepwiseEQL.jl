<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reproducing Figure 3 · StepwiseEQL.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://DanielVandH.github.io/StepwiseEQL.jl/case_studies/figure_3/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">StepwiseEQL.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../repository_structure/">Repository Structure</a></li><li><a class="tocitem" href="../../algorithm/">The Algorithm</a></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">Paper Results</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../overview/">Overview</a></li><li><a class="tocitem" href="../figure_2/">Reproducing Figure 2</a></li><li class="is-active"><a class="tocitem" href>Reproducing Figure 3</a><ul class="internal"><li><a class="tocitem" href="#Just-the-code"><span>Just the code</span></a></li></ul></li><li><a class="tocitem" href="../cs1/">Case Study 1</a></li><li><a class="tocitem" href="../cs2/">Case Study 2</a></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Case Study 3</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../cs3a/">Accurate continuum limit</a></li><li><a class="tocitem" href="../cs3b/">Inaccurate continuum limit</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Case Study 4</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../cs4a/">Accurate continuum limit</a></li><li><a class="tocitem" href="../cs4b/">Inaccurate continuum limit</a></li></ul></li><li><a class="tocitem" href="../../supplementary_material/new_density/">Discrete Densities at the Boundaries</a></li><li><a class="tocitem" href="../../supplementary_material/piecewise_prof/">A Piecewise Proliferation Law</a></li><li><a class="tocitem" href="../../supplementary_material/linear_diffusion/">Linear Diffusion</a></li><li><a class="tocitem" href="../../supplementary_material/parameter_sensitivity/">Parameter Sensitivity Study</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Paper Results</a></li><li class="is-active"><a href>Reproducing Figure 3</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reproducing Figure 3</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DanielVandH/StepwiseEQL.jl/tree/main/docs/src/case_studies/figure_3.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>This example is also available as a Jupyter notebook: <a href="https://github.com/DanielVandH/StepwiseEQL.jl/tree/main/docs/src/case_studies/notebooks/figure_3.ipynb"><code>figure_3.ipynb</code></a></p></div></div><h1 id="Reproducing-Figure-3"><a class="docs-heading-anchor" href="#Reproducing-Figure-3">Reproducing Figure 3</a><a id="Reproducing-Figure-3-1"></a><a class="docs-heading-anchor-permalink" href="#Reproducing-Figure-3" title="Permalink"></a></h1><p>Case studies 3 and 4 also discuss cases where the continuum limit is inaccurate. Figure 3 in the paper summarises these cases, and we reproduce this figure below. First, we load in the packages we will need.</p><pre><code class="language-julia hljs">using StepwiseEQL
using CairoMakie
using EpithelialDynamics1D
using OrdinaryDiffEq
using LinearSolve
using Random
using StatsBase</code></pre><p>The part of the figure involving the third case study is produced below.</p><pre><code class="language-julia hljs"># Case study 3
fig = Figure(fontsize=41)
final_time = 75.0
domain_length = 30.0
midpoint = domain_length / 2
initial_condition = [LinRange(0, 5, 30); LinRange(25, 30, 30)] |&gt; unique!
damping_constant = 1.0
resting_spring_length = 0.2
spring_constant = 1 / 5
k = spring_constant
force_law_parameters = (s=resting_spring_length, k=spring_constant)
force_law = (δ, p) -&gt; p.k * (p.s - δ)
Δt = 1e-2
K = 15.0
β = 1e-2
G = (δ, p) -&gt; max(zero(δ), p.β * p.K * (one(δ) - inv(p.K * δ)))
Gp = (β=β, K=K)
prob = CellProblem(;
    final_time,
    initial_condition,
    damping_constant,
    force_law,
    force_law_parameters,
    proliferation_law=G,
    proliferation_period=Δt,
    proliferation_law_parameters=Gp)
ens_prob = EnsembleProblem(prob)
Random.seed!(123)
times = [0.0, 1.0, 10.0, 25.0, 40.0, 75.0]
esol = solve(ens_prob, Tsit5(), EnsembleSerial(); trajectories=1000, saveat=times)
(; q, r, means, lowers, uppers, knots) = node_densities(esol)
fvm_prob = continuum_limit(prob, 2500, proliferation=true)
fvm_sol = solve(fvm_prob, TRBDF2(linsolve=KLUFactorization()), saveat=esol[1].t)
fig = Figure(fontsize=33)
ax = Axis(fig[1, 1],xlabel=L&quot;x&quot;,ylabel=L&quot;q(x, t)&quot;,
    title=L&quot;(a):$ $ Case study 3&quot;,titlealign=:left,
    width=1200,height=300,
    xticks=(0:10:30, [L&quot;%$s&quot; for s in 0:10:30]),
    yticks=(0:5:20, [L&quot;%$s&quot; for s in 0:5:20]))
colors = (:black, :red, :blue, :green, :orange, :purple)
all_lines = []
for i in eachindex(esol[1])
    line = lines!(ax, knots[i], means[i], color=colors[i], linewidth=5)
    push!(all_lines, line)
    lines!(ax, fvm_prob.geometry.mesh_points, fvm_sol.u[i], color=colors[i], linestyle=:dash, linewidth=8)
end
arrows!(ax, [15.0], [5.0], [0.0], [7.5], color=:black, linewidth=12, arrowsize=50)
text!(ax, [15.5], [7.0], text=L&quot;t&quot;, color=:black, fontsize=47)
resize_to_layout!(fig)
tightlimits!(ax)
ylims!(ax, 0, 20)
resize_to_layout!(fig)</code></pre><p>The part of the figure involving the third case study is produced below.</p><pre><code class="language-julia hljs"># Case study 4
final_time = 250.0
domain_length = 30.0
midpoint = domain_length / 2
initial_condition = [LinRange(0, 5, 30);] |&gt; unique!
damping_constant = 1.0
resting_spring_length = 0.2
spring_constant = 1 / 5
k = spring_constant
force_law_parameters = (s=resting_spring_length, k=spring_constant)
force_law = (δ, p) -&gt; p.k * (p.s - δ)
Δt = 1e-2
K = 15.0
β = 0.15
G = (δ, p) -&gt; max(zero(δ), p.β * (one(δ) - inv(p.K * δ)))
Gp = (β=β, K=K)
prob = CellProblem(;
    final_time,
    initial_condition,
    damping_constant,
    force_law,
    force_law_parameters,
    proliferation_law=G,
    proliferation_period=Δt,
    proliferation_law_parameters=Gp,
    fix_right=false)
ens_prob = EnsembleProblem(prob)
times = [0, 5, 25, 50, 100, 250]
Random.seed!(123)
esol = solve(ens_prob, Tsit5(); trajectories=1000, saveat=times)
pde = continuum_limit(prob, 2500, proliferation=true)
pde_sol = solve(pde, TRBDF2(linsolve=KLUFactorization()), saveat=esol[1].t)
(; q, r, means, lowers, uppers, knots) = node_densities(esol, stat=mean, extrapolate=true)
colors = (:black, :red, :blue, :green, :orange, :purple)
time_indices = [findlast(≤(τ), esol[1].t) for τ in times]
ax21 = Axis(fig[2, 1], xlabel=L&quot;x&quot;, ylabel=L&quot;q(x, t)&quot;,
    title=L&quot;(b):$ $ Case study 4&quot;, titlealign=:left,
    width=1200, height=300, halign=:left,
    xticks=(0:2:10, [L&quot;%$s&quot; for s in 0:2:10]),
    yticks=(0:5:20, [L&quot;%$s&quot; for s in 0:5:20]))
arrows!(ax21, [5.0], [3.0], [3.0], [0.0], color=:black, linewidth=12, arrowsize=50)
text!(ax21, [7.0], [3.5], text=L&quot;t&quot;, fontsize=47)
@views for (j, i) in enumerate(time_indices)
    lines!(ax21, knots[i], means[i], color=colors[j], linewidth=5)
    lines!(ax21, pde.geometry.mesh_points * pde_sol.u[i][end], pde_sol.u[i][begin:(end-1)], color=colors[j], linestyle=:dash, linewidth=8)
end
tightlimits!(ax21)
xlims!(ax21, 0, 10)
ylims!(ax21, 0, 20.0)
resize_to_layout!(fig)</code></pre><p>With all this, we finally obtain the figure.</p><pre><code class="language-julia hljs">fig</code></pre><figure>
    <img src='../../figures/figure3.png', alt='Figure 3 from the paper'><br>
</figure><h2 id="Just-the-code"><a class="docs-heading-anchor" href="#Just-the-code">Just the code</a><a id="Just-the-code-1"></a><a class="docs-heading-anchor-permalink" href="#Just-the-code" title="Permalink"></a></h2><p>An uncommented version of this example is given below. You can view the source code for this file <a href="https://github.com/DanielVandH/StepwiseEQL.jl/tree/main/docs/src/literate_case_studies/figure_3.jl">here</a>.</p><pre><code class="language-julia hljs">using StepwiseEQL
using CairoMakie
using EpithelialDynamics1D
using OrdinaryDiffEq
using LinearSolve
using Random
using StatsBase

# Case study 3
fig = Figure(fontsize=41)
final_time = 75.0
domain_length = 30.0
midpoint = domain_length / 2
initial_condition = [LinRange(0, 5, 30); LinRange(25, 30, 30)] |&gt; unique!
damping_constant = 1.0
resting_spring_length = 0.2
spring_constant = 1 / 5
k = spring_constant
force_law_parameters = (s=resting_spring_length, k=spring_constant)
force_law = (δ, p) -&gt; p.k * (p.s - δ)
Δt = 1e-2
K = 15.0
β = 1e-2
G = (δ, p) -&gt; max(zero(δ), p.β * p.K * (one(δ) - inv(p.K * δ)))
Gp = (β=β, K=K)
prob = CellProblem(;
    final_time,
    initial_condition,
    damping_constant,
    force_law,
    force_law_parameters,
    proliferation_law=G,
    proliferation_period=Δt,
    proliferation_law_parameters=Gp)
ens_prob = EnsembleProblem(prob)
Random.seed!(123)
times = [0.0, 1.0, 10.0, 25.0, 40.0, 75.0]
esol = solve(ens_prob, Tsit5(), EnsembleSerial(); trajectories=1000, saveat=times)
(; q, r, means, lowers, uppers, knots) = node_densities(esol)
fvm_prob = continuum_limit(prob, 2500, proliferation=true)
fvm_sol = solve(fvm_prob, TRBDF2(linsolve=KLUFactorization()), saveat=esol[1].t)
fig = Figure(fontsize=33)
ax = Axis(fig[1, 1],xlabel=L&quot;x&quot;,ylabel=L&quot;q(x, t)&quot;,
    title=L&quot;(a):$ $ Case study 3&quot;,titlealign=:left,
    width=1200,height=300,
    xticks=(0:10:30, [L&quot;%$s&quot; for s in 0:10:30]),
    yticks=(0:5:20, [L&quot;%$s&quot; for s in 0:5:20]))
colors = (:black, :red, :blue, :green, :orange, :purple)
all_lines = []
for i in eachindex(esol[1])
    line = lines!(ax, knots[i], means[i], color=colors[i], linewidth=5)
    push!(all_lines, line)
    lines!(ax, fvm_prob.geometry.mesh_points, fvm_sol.u[i], color=colors[i], linestyle=:dash, linewidth=8)
end
arrows!(ax, [15.0], [5.0], [0.0], [7.5], color=:black, linewidth=12, arrowsize=50)
text!(ax, [15.5], [7.0], text=L&quot;t&quot;, color=:black, fontsize=47)
resize_to_layout!(fig)
tightlimits!(ax)
ylims!(ax, 0, 20)
resize_to_layout!(fig);

# Case study 4
final_time = 250.0
domain_length = 30.0
midpoint = domain_length / 2
initial_condition = [LinRange(0, 5, 30);] |&gt; unique!
damping_constant = 1.0
resting_spring_length = 0.2
spring_constant = 1 / 5
k = spring_constant
force_law_parameters = (s=resting_spring_length, k=spring_constant)
force_law = (δ, p) -&gt; p.k * (p.s - δ)
Δt = 1e-2
K = 15.0
β = 0.15
G = (δ, p) -&gt; max(zero(δ), p.β * (one(δ) - inv(p.K * δ)))
Gp = (β=β, K=K)
prob = CellProblem(;
    final_time,
    initial_condition,
    damping_constant,
    force_law,
    force_law_parameters,
    proliferation_law=G,
    proliferation_period=Δt,
    proliferation_law_parameters=Gp,
    fix_right=false)
ens_prob = EnsembleProblem(prob)
times = [0, 5, 25, 50, 100, 250]
Random.seed!(123)
esol = solve(ens_prob, Tsit5(); trajectories=1000, saveat=times)
pde = continuum_limit(prob, 2500, proliferation=true)
pde_sol = solve(pde, TRBDF2(linsolve=KLUFactorization()), saveat=esol[1].t)
(; q, r, means, lowers, uppers, knots) = node_densities(esol, stat=mean, extrapolate=true)
colors = (:black, :red, :blue, :green, :orange, :purple)
time_indices = [findlast(≤(τ), esol[1].t) for τ in times]
ax21 = Axis(fig[2, 1], xlabel=L&quot;x&quot;, ylabel=L&quot;q(x, t)&quot;,
    title=L&quot;(b):$ $ Case study 4&quot;, titlealign=:left,
    width=1200, height=300, halign=:left,
    xticks=(0:2:10, [L&quot;%$s&quot; for s in 0:2:10]),
    yticks=(0:5:20, [L&quot;%$s&quot; for s in 0:5:20]))
arrows!(ax21, [5.0], [3.0], [3.0], [0.0], color=:black, linewidth=12, arrowsize=50)
text!(ax21, [7.0], [3.5], text=L&quot;t&quot;, fontsize=47)
@views for (j, i) in enumerate(time_indices)
    lines!(ax21, knots[i], means[i], color=colors[j], linewidth=5)
    lines!(ax21, pde.geometry.mesh_points * pde_sol.u[i][end], pde_sol.u[i][begin:(end-1)], color=colors[j], linestyle=:dash, linewidth=8)
end
tightlimits!(ax21)
xlims!(ax21, 0, 10)
ylims!(ax21, 0, 20.0)
resize_to_layout!(fig);

fig</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../figure_2/">« Reproducing Figure 2</a><a class="docs-footer-nextpage" href="../cs1/">Case Study 1 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 23 August 2023 04:46">Wednesday 23 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
